# leadAdd

### Данный скрипт позволяет добавить лид в Битрикс24 из внешней системы посредством POST запроса.

**Механизм работы**:
1. Во внешней системе клиент оставляет заявку. В данном примере рассматривается, что клиент оставляет заявку через бот, который подключен к SendPulse. В целом, данный скрипт можно использовать для любой внешней системы, которая может отправить POST запрос. 
2. Как данные получены, созадется лид внутри Битрикс24. 

Решение может работать как на облачных, так и коробочных Битрикс24. 

**Как запустить**:
1. leadAddFromTG.php и auth.php необходимо разместить на хостинге с поддержкой SSL.
2. В разделе "Разработчикам" необходимо создать входящий вебхук с правами на CRM (crm). Подробнее как создать входящий / исходящий вебхук: [Ссылки на документацию 1С-Битрикс](https://github.com/thnik911/leadAdd/blob/main/README.md#%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8-%D0%BD%D0%B0-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8E-1%D1%81-%D0%B1%D0%B8%D1%82%D1%80%D0%B8%D0%BA%D1%81).
3. Полученный "Вебхук для вызова rest api" прописать в auth.php.
4. В строках 19-27 скрипта leadAddFromTG.php через условие можно указать "Источник" для Битрикс24. При использовании можно добавить свои значения источников в переменной $source, либо удалить данные строки из скрипта и по умолчанию в строке 47 для 'SOURCE_ID' указать ID источника по умолчанию. В данной логике могло запускаться 4 разных бота. В зависимости от вида бота заполнялся нужный источник и запускалась нужная логика внутри Битрикс24.
5. В строках 29-35 через POST запрос приходит выбранный часовой пояс клиентом. Данные строки опциональны, их можно удалить.
6. Пояснение к строке 46 - в дополнительно поле лида сохранятся ID пользователя SendPulse для будущей автоматизации. Автоматизация рассмотрена в https://github.com/thnik911/SendMessageSendPulse
7. Строка 48 хранит дополинтельные сведения об источнике, которые приходят из POST запроса. Строка опциональная, можно удалить.
8. Делаем POST с помощью внешней системы, либо вручную в строке бразуера: https://yourdomain.com/path/leadAddFromTG.php?phone=79001112233&email=test@test.ru&name=Тест&telegramID={{contact_id}}&source={{$bot_id}}&source2={{source}}


**Переменные передаваемые в POST запросе:**

yourdomain.com - адрес сайта, на котором размещены скрипты auth.php и duplicate.php с поддержкой SSL.

path - путь до скрипта.

phone - телефон клиента.

email - почта клиента.

name - имя клиента.

telegramID - user_id SendPulse (опционально, можно не использовать в POST запросе).

source - ID бота SendPulse (опционально, можно не использовать в POST запросе).

source2 - дополнительные сведения об источнике, к примеру, страница захода (опционально, можно не использовать в POST запросе).

### Ссылки на документацию 1С-Битрикс 

<details><summary>Развернуть список</summary>

1. Как создать Webhook https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=99&LESSON_ID=8581&LESSON_PATH=8771.8583.8581

</details>

